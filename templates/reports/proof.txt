<%
    import pandas as pd
    disease=plotter.hash_vars["disease"].replace("_profile", "").capitalize()
    plotter.hash_vars["candidates_sims"].sort(key=lambda row: float(row[1]), reverse=True) 
    plotter.hash_vars["candidates_sims"] = plotter.hash_vars["candidates_sims"][0:50]
    
    pubmed_ids_and_sims = pd.DataFrame(plotter.hash_vars["candidates_sims"], columns=["pubmed_id", "similarity"])
    pubmed_ids_and_titles = pd.DataFrame(plotter.hash_vars["pubmed_ids_and_titles"], columns=["pubmed_id", "title", "article-type", "article-category"])
    
    pubmed_ids_sims_and_titles = pd.merge(pubmed_ids_and_sims, pubmed_ids_and_titles, on="pubmed_id", how="inner")
    pubmed_ids_sims_and_titles.drop(columns=["article-type", "article-category"], inplace=True) #convert back to a list of lists and add the header back
    pubmed_ids_sims_and_titles["similarity"] = pubmed_ids_sims_and_titles["similarity"].astype(float).round(2)
    pubmed_ids_sims_and_titles["pubmed_id"] = pubmed_ids_sims_and_titles["pubmed_id"].apply(lambda pmid: f"<a href=https://pubmed.ncbi.nlm.nih.gov/{pmid}>{pmid}</a>")
    plotter.hash_vars[f"supp_info.txt"] = pubmed_ids_sims_and_titles.values.tolist()
    plotter.hash_vars[f"supp_info.txt"].insert(0, ["pubmed_id", "similarity", "title"])
%>

<%  disease_div = f"<h1> {disease} Syndrome</h1>"   %>
${plotter.prettify_div(disease_div)}

<div class="container-fluid row-offcanvas nopadding">
    <div class="col-sm-7 nopadding">
        <div style="width: 90%; background-color:#ecf0f1; margin: 0 auto;"> 
            <h1 style="text-align: center; background-color:#d6eaf8">Similarity matrix</h1>
            ${plotter.similarity_matrix_plot( id= "similarity_matrix", header= True, row_names= True )}
        </div>

        <div style="width: 90%; background-color:#ecf0f1; margin: 0 auto;"> 
            <h1 style="text-align: center; background-color:#d6eaf8">Negative terms matrix</h1>
            ${plotter.similarity_matrix_plot( id= "negative_matrix", header= True, row_names= True )}
        </div>
    </div>

    <div class="col-sm-5 nopadding">
        ${plotter.table(id="supp_info.txt", styled="dt", text=True, header=True, attrib = {'class' : 'table'}, custom_buttons = ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5'])}
    </div>
</div>